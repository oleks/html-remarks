<!DOCTYPE HTML>
<html>
<head>
<title>Remarks</title>
<style type="text/css">
.mood {
  cursor: pointer; cursor: hand;
}
</style>
</head>
<body>
<div id="remarks"></div>
<script type="text/javascript">

function byId(id) {
  return document.getElementById(id);
}

const remarks_elem = byId("remarks");

var next = {j: 0, t: 0};

function gen(id) {
  return id + (next[id]++).toString(10);
}

function appendTextInput(container) {
  var input = document.createElement("input");
  input.setAttribute("type", "text");
  container.appendChild(input);

  return input;
}

function appendMood(container) {
  var span = document.createElement("span");
  span.className = "mood";
  span.innerHTML = "*";
  container.appendChild(span);
}

function handleKeydown(container, prev, e) {
  if (e.code === "Enter") {
    var container_elem = byId(container);
    var prev_elem = byId(prev);
    appendJudgement(container_elem, prev_elem);
  }
}

function appendJudgement(container, prev) {
  var row = document.createElement("tr");
  row.id = gen("j");

  var mood = document.createElement("td");
  appendMood(mood);

  var text = document.createElement("td");
  input = appendTextInput(text);

  input.setAttribute("onkeydown",
    "handleKeydown(\"" + container.id +
      "\", \"" + row.id + "\", event);");

  row.appendChild(mood);
  row.appendChild(text);
  if (prev === undefined || prev === null) {
    container.appendChild(row);
  } else {
    container.insertBefore(row, prev.nextSibling);
  }
  input.focus();
}

function appendSection(container, depth) {
  var section = document.createElement("section");

  var header = document.createElement("h" + depth);
  appendTextInput(header);
  section.appendChild(header);

  var table = document.createElement("table");
  var tbody = document.createElement("tbody");
  tbody.id = gen("t");
  appendJudgement(tbody);
  table.appendChild(tbody);
  section.appendChild(table);

  container.appendChild(section);
}

if (remarks_elem.children.length === 0) {
  appendSection(remarks_elem, 1);
}

function getFilename() {
  var parts = document.location.href.split("?")[0].split("/");
  var last = parts[parts.length - 1];
  return last.split(".html")[0];
}

document.title = getFilename();

</script>
</body>
</html>
